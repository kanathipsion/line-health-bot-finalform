fetch('/send-message', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    userId: userId,
    flexMessage: {
      type: 'bubble',
      body: {
        type: 'box',
        layout: 'vertical',
        contents: [
          {
            type: 'text',
            text: 'ผลลัพธ์สุขภาพของคุณ',
            weight: 'bold',
            size: 'lg',
          },
          {
            type: 'box',
            layout: 'vertical',
            margin: 'lg',
            spacing: 'sm',
            contents: [
              {
                type: 'box',
                layout: 'baseline',
                spacing: 'sm',
                contents: [
                  {
                    type: 'text',
                    text: 'ค่าน้ำตาล:',
                    color: '#aaaaaa',
                    size: 'sm',
                    flex: 1,
                  },
                  {
                    type: 'text',
                    text: `${sugar} mg/dL`,
                    wrap: true,
                    color: '#666666',
                    size: 'sm',
                    flex: 3,
                  },
                ],
              },
              {
                type: 'box',
                layout: 'baseline',
                spacing: 'sm',
                contents: [
                  {
                    type: 'text',
                    text: 'ค่าความดัน:',
                    color: '#aaaaaa',
                    size: 'sm',
                    flex: 1,
                  },
                  {
                    type: 'text',
                    text: `${pressure} mmHg`,
                    wrap: true,
                    color: '#666666',
                    size: 'sm',
                    flex: 3,
                  },
                ],
              },
              {
                type: 'box',
                layout: 'baseline',
                spacing: 'sm',
                contents: [
                  {
                    type: 'text',
                    text: 'BMI:',
                    color: '#aaaaaa',
                    size: 'sm',
                    flex: 1,
                  },
                  {
                    type: 'text',
                    text: `${bmi} (${bmiCategory})`,
                    wrap: true,
                    color: '#666666',
                    size: 'sm',
                    flex: 3,
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  }),
})
  .then((response) => {
    if (!response.ok) {
      throw new Error('Failed to send message');
    }
    alert('ส่งข้อมูลสำเร็จ! กรุณาตรวจสอบ LINE ของคุณ');
  })
  .catch((error) => {
    console.error('Error:', error);
    alert('เกิดข้อผิดพลาด: ' + error.message);
  });
